EESchema Schematic File Version 2  date 5/16/2011 2:48:40 PM
LIBS:power
LIBS:device
LIBS:transistors
LIBS:conn
LIBS:linear
LIBS:regul
LIBS:74xx
LIBS:cmos4000
LIBS:adc-dac
LIBS:memory
LIBS:xilinx
LIBS:special
LIBS:microcontrollers
LIBS:dsp
LIBS:microchip
LIBS:analog_switches
LIBS:motorola
LIBS:texas
LIBS:intel
LIBS:audio
LIBS:interface
LIBS:digital-audio
LIBS:philips
LIBS:display
LIBS:cypress
LIBS:siliconi
LIBS:opto
LIBS:atmel
LIBS:contrib
LIBS:valves
LIBS:wheelerlab
LIBS:control-board-cache
EELAYER 25  0
EELAYER END
$Descr A4 11700 8267
encoding utf-8
Sheet 4 4
Title "Control board"
Date "16 may 2011"
Rev "v1.1"
Comp "Wheeler Microfluidics Lab"
Comment1 ""
Comment2 ""
Comment3 ""
Comment4 ""
$EndDescr
Wire Wire Line
	5050 3100 5050 2250
Wire Wire Line
	5150 2450 5150 1950
Wire Wire Line
	5300 2450 5150 2450
Wire Wire Line
	5150 1950 4300 1950
Wire Wire Line
	7150 1700 7400 1700
Wire Wire Line
	7400 2050 7900 2050
Connection ~ 7150 1300
Wire Wire Line
	7400 2050 7400 1700
Connection ~ 7400 1300
Wire Wire Line
	10400 3350 10400 3250
Wire Wire Line
	10400 3250 10200 3250
Wire Wire Line
	5800 4400 5800 4300
Connection ~ 4500 4400
Wire Wire Line
	4500 4750 4500 4300
Wire Wire Line
	4500 4200 4250 4200
Wire Wire Line
	4250 4200 4250 5050
Wire Wire Line
	4250 5050 4600 5050
Wire Wire Line
	4600 5050 4600 5850
Wire Wire Line
	4600 5850 4550 5850
Connection ~ 4150 5550
Wire Wire Line
	3950 5550 4150 5550
Wire Wire Line
	4500 3800 4150 3800
Wire Wire Line
	4150 3800 4150 5850
Wire Wire Line
	3500 3900 4500 3900
Wire Wire Line
	6500 4000 6500 3350
Wire Wire Line
	6500 4000 5800 4000
Wire Wire Line
	5800 3900 5800 3800
Wire Wire Line
	1850 2400 1850 3000
Wire Wire Line
	3600 3000 3350 3000
Wire Wire Line
	3350 3000 3350 2400
Wire Wire Line
	3350 2400 1850 2400
Wire Wire Line
	3350 1250 3350 1850
Wire Wire Line
	3350 1250 1850 1250
Wire Wire Line
	2750 2600 2300 2600
Wire Wire Line
	3850 1650 3850 1450
Wire Wire Line
	3850 1450 4300 1450
Wire Wire Line
	6150 2450 6150 1850
Wire Wire Line
	6150 1850 5900 1850
Wire Wire Line
	3550 6150 3150 6150
Wire Wire Line
	6500 3350 6400 3350
Wire Wire Line
	3550 7000 3550 6400
Wire Wire Line
	3550 6400 3350 6400
Connection ~ 3350 6800
Wire Wire Line
	3750 6800 3150 6800
Wire Wire Line
	3150 6400 1450 6400
Wire Wire Line
	3350 6400 3350 5850
Connection ~ 2450 6400
Wire Wire Line
	2450 6300 2450 6400
Connection ~ 3000 5850
Wire Wire Line
	2800 6000 3000 6000
Wire Wire Line
	3000 6000 3000 5450
Connection ~ 3150 5450
Wire Wire Line
	3550 5550 3550 5450
Wire Wire Line
	3550 5450 1450 5450
Wire Wire Line
	1450 5450 1450 5650
Wire Wire Line
	3150 5450 3150 5550
Connection ~ 2550 5450
Wire Wire Line
	3000 5850 2800 5850
Connection ~ 3000 5450
Wire Wire Line
	1450 6400 1450 6050
Wire Wire Line
	2600 6400 2600 6300
Connection ~ 2600 6400
Wire Wire Line
	3750 5850 3750 6400
Wire Wire Line
	3150 6800 3150 6150
Connection ~ 3150 6400
Wire Wire Line
	3750 6400 3950 6400
Wire Wire Line
	3950 6400 3950 7000
Wire Wire Line
	5900 3350 6000 3350
Connection ~ 5900 3350
Wire Wire Line
	6850 3350 6850 2850
Wire Wire Line
	6850 2850 6500 2850
Wire Wire Line
	6150 2850 5900 2850
Wire Wire Line
	2300 1650 2300 1450
Connection ~ 2750 1450
Wire Wire Line
	2300 2600 2300 2800
Connection ~ 2750 2600
Wire Wire Line
	2300 1450 2750 1450
Wire Wire Line
	4300 2600 3850 2600
Wire Wire Line
	3850 2600 3850 2800
Wire Wire Line
	1850 1250 1850 1850
Wire Wire Line
	1850 1850 2050 1850
Wire Wire Line
	3350 1850 3600 1850
Wire Wire Line
	1850 3000 2050 3000
Wire Wire Line
	4300 1450 4300 1300
Wire Wire Line
	4300 1300 4700 1300
Wire Wire Line
	4300 3100 5050 3100
Wire Wire Line
	5800 3800 6850 3800
Wire Wire Line
	6850 3800 6850 3750
Wire Wire Line
	5900 2850 5900 4100
Wire Wire Line
	5900 4100 5800 4100
Wire Wire Line
	3950 6150 3850 6150
Wire Wire Line
	3850 6150 3850 3900
Connection ~ 3850 3900
Wire Wire Line
	3700 4100 3700 4000
Wire Wire Line
	3700 4000 4500 4000
Wire Wire Line
	4350 5150 4150 5150
Connection ~ 4150 5150
Wire Wire Line
	5200 4700 5200 4150
Wire Wire Line
	5200 4150 4500 4150
Wire Wire Line
	4500 4150 4500 4100
Wire Wire Line
	9800 3750 10200 3750
Wire Wire Line
	9800 3850 10400 3850
Wire Wire Line
	7900 1950 7700 1950
Wire Wire Line
	7700 1950 7700 1300
Wire Wire Line
	7900 2050 7900 2150
Wire Wire Line
	7700 1300 7150 1300
Wire Wire Line
	5050 2250 5300 2250
Text GLabel 7150 1700 0    60   Input ~ 0
GND
$Comp
L C C23
U 1 1 4DD1675D
P 7400 1500
F 0 "C23" H 7450 1600 50  0000 L CNN
F 1 "0.01uF" H 7450 1400 50  0000 L CNN
	1    7400 1500
	1    0    0    -1  
$EndComp
$Comp
L C C22
U 1 1 4DD16726
P 7150 1500
F 0 "C22" H 7200 1600 50  0000 L CNN
F 1 "0.1uF" H 7200 1400 50  0000 L CNN
	1    7150 1500
	1    0    0    -1  
$EndComp
NoConn ~ 9800 4200
NoConn ~ 9800 4100
Text GLabel 9800 3850 2    60   Input ~ 0
SCL
Text GLabel 5800 4200 2    60   Input ~ 0
VGND
Text GLabel 4500 4100 0    60   Input ~ 0
+5V
Text GLabel 4350 6150 0    60   Input ~ 0
VGND
$Comp
L C C16
U 1 1 4DCD350E
P 4350 5350
F 0 "C16" H 4400 5450 50  0000 L CNN
F 1 "1uF" H 4400 5250 50  0000 L CNN
	1    4350 5350
	1    0    0    -1  
$EndComp
$Comp
L C C13
U 1 1 4DCD3405
P 2800 3900
F 0 "C13" H 2850 4000 50  0000 L CNN
F 1 "1uF" H 2850 3800 50  0000 L CNN
	1    2800 3900
	0    -1   -1   0   
$EndComp
$Comp
L R R20
U 1 1 4DCD33E5
P 3250 3900
F 0 "R20" V 3330 3900 50  0000 C CNN
F 1 "5.1k" V 3250 3900 50  0000 C CNN
	1    3250 3900
	0    -1   -1   0   
$EndComp
$Comp
L R R21
U 1 1 4DCD33C1
P 3450 4100
F 0 "R21" V 3530 4100 50  0000 C CNN
F 1 "3k" V 3450 4100 50  0000 C CNN
	1    3450 4100
	0    -1   -1   0   
$EndComp
Text GLabel 3200 4100 0    60   Input ~ 0
VGND
$Comp
L MCP6024 IC12
U 1 1 4DCD3080
P 5150 4100
F 0 "IC12" H 5150 4600 60  0000 C CNN
F 1 "MCP6024" H 5160 3600 60  0000 C CNN
	1    5150 4100
	1    0    0    -1  
$EndComp
Text Label 4550 3100 0    60   ~ 0
FB_SQUARE
Text Label 4550 1950 0    60   ~ 0
HV_SQUARE
Text GLabel 4700 1700 0    60   Input ~ 0
GND
Text GLabel 3850 3400 0    60   Input ~ 0
GND
Text GLabel 2300 3400 0    60   Input ~ 0
GND
Text GLabel 3850 2600 0    60   Input ~ 0
+5V
Text GLabel 3850 1450 0    60   Input ~ 0
+5V
Text GLabel 3850 2250 0    60   Input ~ 0
GND
Text GLabel 2300 2250 0    60   Input ~ 0
GND
Text GLabel 2300 2600 0    60   Input ~ 0
+5V
Text GLabel 1850 2400 0    60   Input ~ 0
FEEDBACK
$Comp
L LM339 IC10
U 4 1 4DCD292E
P 3950 3100
F 0 "IC10" H 4050 3350 60  0000 C CNN
F 1 "LM339" H 4050 2850 60  0000 C CNN
	4    3950 3100
	1    0    0    -1  
$EndComp
Text GLabel 3600 2050 0    60   Input ~ 0
VGND
Text GLabel 2050 3200 0    60   Input ~ 0
AREF
$Comp
L LM339 IC10
U 3 1 4DCD292D
P 3950 1950
F 0 "IC10" H 4050 2200 60  0000 C CNN
F 1 "LM339" H 4100 1750 60  0000 C CNN
	3    3950 1950
	1    0    0    -1  
$EndComp
$Comp
L LM339 IC10
U 1 1 4DCD27E0
P 2400 1950
F 0 "IC10" H 2500 2200 60  0000 C CNN
F 1 "LM339" H 2550 1750 60  0000 C CNN
	1    2400 1950
	1    0    0    -1  
$EndComp
Text GLabel 7900 2950 0    60   Input ~ 0
PC_LPF
Text GLabel 7900 2850 0    60   Input ~ 0
PC
$Comp
L C C19
U 1 1 4DCC53E6
P 6150 2650
F 0 "C19" H 6200 2750 50  0000 L CNN
F 1 "0.1uF" H 6200 2550 50  0000 L CNN
	1    6150 2650
	1    0    0    -1  
$EndComp
Text GLabel 6850 3800 2    60   Input ~ 0
PC_LPF
Text GLabel 6500 2350 2    60   Input ~ 0
PC
Text Notes 6500 2050 0    60   ~ 0
10 Hz, 2nd-order\nlow-pass filter
Text Notes 1300 7000 0    60   ~ 0
Digital potentiometers:\n  POT1 sets AREF\n  POT2 sets VGND\n  POT3 amplifies WAVE_OUT_3Vp-p to 5Vp-p\n  POT4 attenuates WAVE_OUT (adjustable from 0-5Vp-p)
Text GLabel 4500 4750 2    60   Input ~ 0
WAVE_OUT
Text GLabel 2600 3900 0    60   Input ~ 0
WAVE_OUT_3Vp-p
$Comp
L C C21
U 1 1 4DCC4814
P 6850 3550
F 0 "C21" H 6900 3650 50  0000 L CNN
F 1 "0.22uF" H 6900 3450 50  0000 L CNN
	1    6850 3550
	-1   0    0    1   
$EndComp
$Comp
L C C20
U 1 1 4DCC47D8
P 6200 3350
F 0 "C20" H 6250 3450 50  0000 L CNN
F 1 "0.1uF" H 6250 3250 50  0000 L CNN
	1    6200 3350
	0    1    1    0   
$EndComp
$Comp
L R R25
U 1 1 4DCC47D1
P 6500 3100
F 0 "R25" V 6580 3100 50  0000 C CNN
F 1 "100k" V 6500 3100 50  0000 C CNN
	1    6500 3100
	1    0    0    -1  
$EndComp
$Comp
L R R24
U 1 1 4DCC47CA
P 6500 2600
F 0 "R24" V 6580 2600 50  0000 C CNN
F 1 "100k" V 6500 2600 50  0000 C CNN
	1    6500 2600
	1    0    0    -1  
$EndComp
Text GLabel 5200 5100 2    60   Input ~ 0
GND
$Comp
L C C18
U 1 1 4DCC473A
P 5200 4900
F 0 "C18" H 5250 5000 50  0000 L CNN
F 1 "0.1uF" H 5250 4800 50  0000 L CNN
	1    5200 4900
	1    0    0    -1  
$EndComp
Text GLabel 3950 7000 0    60   Input ~ 0
POT2
Text GLabel 3550 7000 0    60   Input ~ 0
POT1
$Comp
L C C15
U 1 1 4DCC4478
P 3750 6600
F 0 "C15" H 3800 6700 50  0000 L CNN
F 1 "0.1uF" H 3800 6500 50  0000 L CNN
	1    3750 6600
	1    0    0    -1  
$EndComp
$Comp
L C C14
U 1 1 4DCC4472
P 3350 6600
F 0 "C14" H 3400 6700 50  0000 L CNN
F 1 "0.1uF" H 3400 6500 50  0000 L CNN
	1    3350 6600
	1    0    0    -1  
$EndComp
$Comp
L C C12
U 1 1 4DCC4445
P 1450 5850
F 0 "C12" H 1500 5950 50  0000 L CNN
F 1 "0.1uF" H 1500 5750 50  0000 L CNN
	1    1450 5850
	1    0    0    -1  
$EndComp
NoConn ~ 2050 5850
Text GLabel 2050 6000 0    60   Input ~ 0
MOSI
Text GLabel 2050 5700 0    60   Input ~ 0
SCK
Text GLabel 1450 6400 0    60   Input ~ 0
GND
Text GLabel 2800 5700 2    60   Input ~ 0
SS
Text GLabel 1450 5450 0    60   Input ~ 0
+5V
$Comp
L AD5204 IC11
U 1 1 4DCC43F3
P 3400 5850
F 0 "IC11" H 2250 5450 60  0000 C CNN
F 1 "AD5204" H 2300 6200 60  0000 C CNN
	1    3400 5850
	1    0    0    -1  
$EndComp
Text GLabel 9800 1950 2    60   Input ~ 0
D9
Text Notes 5400 1700 0    60   ~ 0
Phase comparator
Text Notes 8400 1200 0    60   ~ 0
Arduino Mega2560
Text Notes 2550 950  0    60   ~ 0
Comparators for peak detection and for\nconverting FEEDBACK and HV_ATTEN into\nsquare waves for phase comparison
Text GLabel 5900 3350 0    60   Input ~ 0
GND
Text GLabel 5900 1850 0    60   Input ~ 0
+5V
Text GLabel 2750 3100 2    60   Input ~ 0
FB_PEAK
Text GLabel 2300 1450 0    60   Input ~ 0
+5V
Text GLabel 2750 1950 2    60   Input ~ 0
HV_PEAK
Text GLabel 2050 2050 0    60   Input ~ 0
AREF
Text GLabel 3600 3200 0    60   Input ~ 0
VGND
Text GLabel 1850 1250 0    60   Input ~ 0
HV_ATTEN
Text GLabel 7150 1300 0    60   Input ~ 0
+5V
Text GLabel 7900 2550 0    60   Input ~ 0
FEEDBACK
Text GLabel 7900 2450 0    60   Input ~ 0
HV_ATTEN
Text GLabel 7900 2650 0    60   Input ~ 0
WAVE_OUT
Text GLabel 7900 2750 0    60   Input ~ 0
VGND
Text GLabel 7900 4750 0    60   Input ~ 0
MOSI
Text GLabel 7900 4650 0    60   Input ~ 0
SCK
Text GLabel 7900 4550 0    60   Input ~ 0
SS
Text GLabel 7900 4400 0    60   Input ~ 0
GND
Text GLabel 7900 4300 0    60   Input ~ 0
GND
Text GLabel 10400 3250 2    60   Input ~ 0
+5V
Text GLabel 9800 3750 2    60   Input ~ 0
SDA
Text GLabel 9800 2750 2    60   Input ~ 0
FB_PEAK
Text GLabel 9800 2650 2    60   Input ~ 0
HV_PEAK
Text GLabel 9800 1850 2    60   Input ~ 0
D10
Text GLabel 9800 1750 2    60   Input ~ 0
D11
Text GLabel 9800 1650 2    60   Input ~ 0
D12
Text GLabel 9800 1550 2    60   Input ~ 0
D13
Text GLabel 9800 1450 2    60   Input ~ 0
GND
Text GLabel 9800 1350 2    60   Input ~ 0
AREF
$Comp
L R R19
U 1 1 4DCB01C9
P 2750 2850
F 0 "R19" V 2830 2850 50  0000 C CNN
F 1 "1k" V 2750 2850 50  0000 C CNN
	1    2750 2850
	-1   0    0    1   
$EndComp
$Comp
L R R23
U 1 1 4DCB01C4
P 4300 2850
F 0 "R23" V 4380 2850 50  0000 C CNN
F 1 "1k" V 4300 2850 50  0000 C CNN
	1    4300 2850
	-1   0    0    1   
$EndComp
$Comp
L R R22
U 1 1 4DCB01B2
P 4300 1700
F 0 "R22" V 4380 1700 50  0000 C CNN
F 1 "1k" V 4300 1700 50  0000 C CNN
	1    4300 1700
	-1   0    0    1   
$EndComp
$Comp
L R R18
U 1 1 4DCB01A7
P 2750 1700
F 0 "R18" V 2830 1700 50  0000 C CNN
F 1 "1k" V 2750 1700 50  0000 C CNN
	1    2750 1700
	-1   0    0    1   
$EndComp
$Comp
L C C17
U 1 1 4DCAFEF3
P 4700 1500
F 0 "C17" H 4750 1600 50  0000 L CNN
F 1 "0.1uF" H 4750 1400 50  0000 L CNN
	1    4700 1500
	1    0    0    -1  
$EndComp
$Comp
L 74LVC1G86 IC13
U 1 1 4DCAFED2
P 5900 2350
F 0 "IC13" H 5900 2400 60  0000 C CNN
F 1 "74LVC1G86" H 5550 2600 60  0000 C CNN
	1    5900 2350
	1    0    0    -1  
$EndComp
$Comp
L LM339 IC10
U 2 1 4DCAF290
P 2400 3100
F 0 "IC10" H 2500 3350 60  0000 C CNN
F 1 "LM339" H 2500 2850 60  0000 C CNN
	2    2400 3100
	1    0    0    -1  
$EndComp
NoConn ~ 9800 3250
NoConn ~ 9800 3150
NoConn ~ 9800 3350
NoConn ~ 9800 3450
NoConn ~ 9800 3550
NoConn ~ 9800 4450
NoConn ~ 9800 4550
NoConn ~ 9800 4650
NoConn ~ 9800 4350
NoConn ~ 9800 4850
NoConn ~ 9800 4950
NoConn ~ 9800 5050
NoConn ~ 9800 4750
NoConn ~ 7900 2250
NoConn ~ 7900 3750
NoConn ~ 7900 4050
NoConn ~ 7900 3950
NoConn ~ 7900 3850
NoConn ~ 7900 3350
NoConn ~ 7900 3650
NoConn ~ 7900 3550
NoConn ~ 7900 3450
NoConn ~ 7900 3050
$Comp
L ARDUINO_MEGA_SHIELD SHIELD1
U 1 1 4DCAE22B
P 8900 3700
F 0 "SHIELD1" H 8450 6050 60  0000 C CNN
F 1 "ARDUINO_MEGA_SHIELD" H 8850 1150 60  0000 C CNN
	1    8900 3700
	1    0    0    -1  
$EndComp
NoConn ~ 9800 2250
NoConn ~ 9800 3650
NoConn ~ 9800 2050
NoConn ~ 7900 4850
NoConn ~ 7900 6150
NoConn ~ 7900 6050
NoConn ~ 7900 5950
NoConn ~ 7900 5850
NoConn ~ 7900 5600
NoConn ~ 7900 5500
NoConn ~ 7900 5400
NoConn ~ 7900 5300
NoConn ~ 7900 5200
NoConn ~ 7900 5100
NoConn ~ 7900 5000
NoConn ~ 7900 3150
NoConn ~ 9800 2950
NoConn ~ 9800 2850
NoConn ~ 9800 5900
NoConn ~ 9800 5800
NoConn ~ 9800 5700
NoConn ~ 9800 5600
NoConn ~ 9800 5500
NoConn ~ 9800 5400
NoConn ~ 9800 5300
NoConn ~ 9800 5200
NoConn ~ 9800 2550
NoConn ~ 9800 2450
NoConn ~ 9800 2350
NoConn ~ 7900 1850
NoConn ~ 7900 1750
$Comp
L R R26
U 1 1 4D5B5C57
P 10200 3500
F 0 "R26" V 10280 3500 50  0000 C CNN
F 1 "5.1k" V 10200 3500 50  0000 C CNN
	1    10200 3500
	-1   0    0    1   
$EndComp
$Comp
L R R27
U 1 1 4D5B5C50
P 10400 3600
F 0 "R27" V 10480 3600 50  0000 C CNN
F 1 "5.1k" V 10400 3600 50  0000 C CNN
	1    10400 3600
	-1   0    0    1   
$EndComp
$EndSCHEMATC
